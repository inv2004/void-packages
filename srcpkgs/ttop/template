# Template file for 'ttop'
pkgname=ttop
version=1.5.3
revision=1
hostmakedepends="git nim"
short_desc="System monitoring tool with historical data service and top-like TUI"
maintainer="inv2004 <inv2004@gmail.com>"
license="MIT"
homepage="https://github.com/inv2004/ttop"
distfiles="${homepage}/archive/refs/tags/v${version}.tar.gz"
checksum="53033f6127e43fb6de22f35bd9145d5de680a6a992da4bfd05a15ffed51f8895"

do_build() {
	local arch args
	case "$XBPS_TARGET_MACHINE" in
		aarch64*) arch=arm64;;
		arm*)     arch=arm;;
		mips*)    arch=mips;;
		ppc64le*) arch=powerpc64el;;
		ppc64*)   arch=powerpc64;;
		ppc*)     arch=powerpc;;
		riscv64*) arch=riscv64;;
		x86_64*)  arch=amd64;;
		i686)     arch=i386;;
		*)        msg_error "ttop: $XBPS_TARGET_MACHINE unknown to template";;
	esac
	if [ -z "$CROSS_BUILD" ]; then
		cat >>nim.cfg <<-EOF
		gcc.options.always = "$CFLAGS"
		gcc.options.linker = "$LDFLAGS"
		EOF
	fi
	if [ -n "$arch" ]; then
		cat >>nim.cfg <<-EOF
		$arch.linux.gcc.exe = "$CC"
		$arch.linux.gcc.linkerexe = "$CC"
		EOF
	  args="--cpu:$arch"
	fi
	nimble -y build -d:release "$args" --path:$wrksrc
}

do_install() {
	vbin ttop
	vlicense LICENSE
}
